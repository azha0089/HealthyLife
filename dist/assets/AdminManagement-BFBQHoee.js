import{_ as H,r as n,o as J,c as K,a as Q,b as f,d as a,w as l,e as i,g as W,E as u,f as o,u as C,p as X,h as Y,t as D,S as Z,n as S,i as ee,j as ae,k as le,l as te}from"./index-CdwB1mUE.js";const de={class:"admin-management"},oe={class:"page-header"},ie={class:"header-left"},ne={class:"header-actions"},se={class:"dialog-footer"},me={class:"dialog-footer"},ue={__name:"AdminManagement",setup(re){const k=n([]),N=n(!1),c=n(!1),V=n(),w=n(!1),s=n({email:"",displayName:""}),_=n(!1),U=n(),A=n(!1),r=n({uid:"",email:"",displayName:""}),h={email:[{required:!0,message:"Please enter email",trigger:"blur"},{type:"email",message:"Invalid email format",trigger:["blur","change"]}]},L={},v=async()=>{try{N.value=!0,k.value=await W("admin")}catch{u.error("Failed to load admins")}finally{N.value=!1}},B=()=>{c.value=!0,s.value={email:"",displayName:""},S(()=>{var t,e;return(e=(t=V.value)==null?void 0:t.clearValidate)==null?void 0:e.call(t)})},$=async()=>{try{if(!await V.value.validate())return;w.value=!0,await le({email:s.value.email,displayName:s.value.displayName,role:"admin"}),u.success("Admin created"),c.value=!1,v()}catch(t){t!=null&&t.message?u.error(t.message):u.error("Failed to create admin")}finally{w.value=!1}},I=t=>{_.value=!0,r.value={uid:t.uid,email:t.email,displayName:t.displayName||""},S(()=>{var e,y;return(y=(e=U.value)==null?void 0:e.clearValidate)==null?void 0:y.call(e)})},z=async()=>{try{A.value=!0,await te(r.value.uid,{displayName:r.value.displayName}),u.success("Updated"),_.value=!1,v()}catch(t){u.error((t==null?void 0:t.message)||"Failed to update")}finally{A.value=!1}},P=async t=>{try{await ee.confirm(`Delete admin ${t.email}?`,"Confirm",{type:"warning"}),await ae(t.uid),u.success("Deleted"),v()}catch(e){e!=="cancel"&&u.error((e==null?void 0:e.message)||"Failed to delete")}};function x(t){if(!t)return"—";if(t.toDate)return t.toDate().toLocaleString("en-US");const e=new Date(t);return isNaN(e)?"—":e.toLocaleString("en-US")}return J(v),(t,e)=>{const y=i("el-breadcrumb-item"),T=i("el-breadcrumb"),E=i("el-icon"),m=i("el-button"),j=i("el-alert"),p=i("el-table-column"),q=i("el-table"),O=i("el-card"),g=i("el-input"),b=i("el-form-item"),F=i("el-form"),M=i("el-dialog");return Q(),K("div",de,[f("div",oe,[f("div",ie,[e[9]||(e[9]=f("h2",null,"Admin Management",-1)),a(T,{separator:"/"},{default:l(()=>[a(y,{to:{path:"/admin"}},{default:l(()=>[...e[7]||(e[7]=[o("Admin",-1)])]),_:1}),a(y,null,{default:l(()=>[...e[8]||(e[8]=[o("Admin Management",-1)])]),_:1})]),_:1})]),f("div",ne,[a(m,{type:"success",onClick:B},{default:l(()=>[a(E,null,{default:l(()=>[a(C(X))]),_:1}),e[10]||(e[10]=o(" Add Admin ",-1))]),_:1}),a(m,{type:"primary",onClick:v},{default:l(()=>[a(E,null,{default:l(()=>[a(C(Y))]),_:1}),e[11]||(e[11]=o(" Refresh ",-1))]),_:1})])]),a(j,{title:"Only super admin (admin@admin.com) can access this page",type:"warning","show-icon":"",class:"mb16"}),a(O,{class:"table-card"},{default:l(()=>[a(q,{data:k.value,loading:N.value,stripe:"",style:{width:"100%"}},{default:l(()=>[a(p,{type:"index",width:"60"}),a(p,{prop:"email",label:"Email","min-width":"220"}),a(p,{prop:"displayName",label:"Display Name","min-width":"160"},{default:l(({row:d})=>[o(D(d.displayName||"Not Set"),1)]),_:1}),a(p,{prop:"createdAt",label:"Created",width:"180"},{default:l(({row:d})=>[o(D(x(d.createdAt)),1)]),_:1}),a(p,{prop:"updatedAt",label:"Updated",width:"180"},{default:l(({row:d})=>[o(D(x(d.updatedAt)),1)]),_:1}),a(p,{label:"Actions",width:"200",fixed:"right"},{default:l(({row:d})=>{var R;return[a(m,{size:"small",onClick:G=>I(d)},{default:l(()=>[...e[12]||(e[12]=[o("Edit",-1)])]),_:2},1032,["onClick"]),a(m,{size:"small",type:"danger",onClick:G=>P(d),disabled:((R=d.email)==null?void 0:R.toLowerCase())===C(Z)},{default:l(()=>[...e[13]||(e[13]=[o("Delete",-1)])]),_:2},1032,["onClick","disabled"])]}),_:1})]),_:1},8,["data","loading"])]),_:1}),a(M,{modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=d=>c.value=d),title:"Add Admin",width:"500px"},{footer:l(()=>[f("span",se,[a(m,{onClick:e[2]||(e[2]=d=>c.value=!1)},{default:l(()=>[...e[14]||(e[14]=[o("Cancel",-1)])]),_:1}),a(m,{type:"primary",loading:w.value,onClick:$},{default:l(()=>[...e[15]||(e[15]=[o("Confirm",-1)])]),_:1},8,["loading"])])]),default:l(()=>[a(F,{ref_key:"addFormRef",ref:V,model:s.value,rules:h,"label-width":"110px"},{default:l(()=>[a(b,{label:"Email",prop:"email"},{default:l(()=>[a(g,{modelValue:s.value.email,"onUpdate:modelValue":e[0]||(e[0]=d=>s.value.email=d),placeholder:"admin email"},null,8,["modelValue"])]),_:1}),a(b,{label:"Display Name"},{default:l(()=>[a(g,{modelValue:s.value.displayName,"onUpdate:modelValue":e[1]||(e[1]=d=>s.value.displayName=d),placeholder:"optional"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(M,{modelValue:_.value,"onUpdate:modelValue":e[6]||(e[6]=d=>_.value=d),title:"Edit Admin",width:"500px"},{footer:l(()=>[f("span",me,[a(m,{onClick:e[5]||(e[5]=d=>_.value=!1)},{default:l(()=>[...e[16]||(e[16]=[o("Cancel",-1)])]),_:1}),a(m,{type:"primary",loading:A.value,onClick:z},{default:l(()=>[...e[17]||(e[17]=[o("Save",-1)])]),_:1},8,["loading"])])]),default:l(()=>[a(F,{ref_key:"editFormRef",ref:U,model:r.value,rules:L,"label-width":"110px"},{default:l(()=>[a(b,{label:"Email"},{default:l(()=>[a(g,{value:r.value.email,disabled:""},null,8,["value"])]),_:1}),a(b,{label:"Display Name"},{default:l(()=>[a(g,{modelValue:r.value.displayName,"onUpdate:modelValue":e[4]||(e[4]=d=>r.value.displayName=d)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},fe=H(ue,[["__scopeId","data-v-72b8e20a"]]);export{fe as default};
